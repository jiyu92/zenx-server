// This file handles the delivery of static assets such as code, images // and audio files var express = require('express'),     router   = express.Router(),     compress = require('compression'),     path     = require('path'),     zenOut   = require(path.resolve(__dirname + '/../zenOut.js')),     jade     = global.jade,     lang     = global.languages,     package  = require(path.resolve(__dirname + '/../package.json')),     fs       = require('fs'),     modules  = fs.readdirSync(path.resolve(__dirname + '/../modules')).toString().split(',');  // Always compress assets router.use(compress());  // Always add cache control header router.use(function (req, res, next) {     res.setHeader("Cache-Control", "max-age=31104000");     return next(); });  // Handle module file requests modules.forEach(function (dir) {     router.use('/modules/' + dir, express.static(__dirname + '/../modules/' + dir + '/client')); });  router.use(express.static(__dirname + '/../assets'));   router.get("*.jade", function (req,res,next) {          var fn = jade.compileFile(__dirname + '/../layouts/' + req.path.split('/').pop(), {});     res.send(fn({         baseUrl: '/',         lang: lang["en"],         version: package.version     }));     zenOut("Served file " + req.path.split('/').pop());  });  router.get('*', function (req, res, next) {      var fn = jade.compileFile(__dirname + '/../layouts/app.jade',{});      res.send(fn({         baseUrl: '/',         lang: lang["en"],         version: package.version     }));     zenOut("Served an HTTPS request just now.");  });  module.exports = router;